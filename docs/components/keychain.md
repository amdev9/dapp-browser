# Keychain
Компонент работы с подписью транзакций в Dapp, позволяет:
- Создавать новые ключи
- Подписыать транзакции с помощью ключа
- Просматривать список всех доступных ключей
- Смотреть установленный по умолчанию для текущего DApp ключ.

### Lyfecycle Пояснение процесса
**Манифест: определение прав**
Модуль keychain имеет различные защищенные сущности и методы относительно которых происходит взаимодействие со стороны dapp. Регулируются они правами запрошенными dapp для своего приложения.
- _"keychain.full"_ - полный доступ к модулю Keychain (методы: ```create```, ```sign```), с возможностью создавать ключи, и подписывать ключем по имени. А также с 
- _"keychain.private"_ - доступ к методу ```requestSign``` для запроса на подпись.  

**Регуляция прав на подпись**
*Прямой запрос на подпись с уведомленем*: доступ к конкретному методу ```requestSign``` при котором происходит вызов блока в клиенте: и пользователю со стороны клиента показывается (dropdown или модальное окно) в котором его предупреждают что этот dapp хочет запросить подпись по ключу, пользователь выбирает ключ которым он хочет подписать или отказывается от подписи - в итоге dapp получает только финальную подпись или reject. У метода request есть поле ```requestMessageInfo``` которое будет показываться вместе с модальным окном и должно содержать короткое описание причины для чего была вызвана подпись. 

*Предоставление первентивного доступа к подписи*: позволяет определять со стороны пользователя в интерфейсе client разблокировать доступ к подписи. В таком случае при вызове функции `requestSign` без показа модального окна будет возвращен результат. Пользователь предоставляющий первентивный доступ может выбрать промежуток времени на протяжении которого будет действовать ключ (одна минута - или пока живет сессия окна текущего окна DApp), и выбирает ключ который будет использоватся для подписи.


### Основные структуры данных.
- [ActiveKey](https://github.com/arrayio/docs.array.io/blob/master/typing-declarations/keychain.d.ts#L16): экземпляр обертка поверх статичных методов Keychain, объект имеет встроенный метод вызова подписи.
- [Keychain](https://github.com/arrayio/docs.array.io/blob/master/typing-declarations/keychain.d.ts#L24): класс с базовыми статичными методами для работы с ключами и подписями, также хранящий в себе текущий ключ относительно запущенного сейчас DApp.

### Примеры использования Keychain
```jsx
// Исмпользование keychain на стороне клиента со всем функционалом и методами.
let keyname = "my_awesome_key";
let createdKey = await Keychain.create(key: keyname, algorithm: "AES256", curve: "SECP256K1");

// Использование где-нибудь в DApp
try {
  let signed = await Keychain.defaultKey.sign(
    "de5f4d8974715e20f47c8bb609547c9e66b0b9e31d521199b3d8",
    "871689d060721b5cec5a010080841e00000000000011130065cd1d0000000000000000"
  );

  console.log(signed);
  // Output: 200095af52eb0281237904da0f03ba2091d39dc256950b12b21deb990ff620a3a57876b1c3fca281612314f6155736cd0507355bf031d33330ad0cc5e687d7eb02
} catch (error) {
  // error exception handle
}
```

### Смежные ссылки:
[Пример команд для pipe based команды keychain](https://github.com/arrayio/array-io-keychain/wiki/keychain-sample-commands)

Пример вывода и ответа на команды keychain-ом
``` 
{ "command": "CMD_CREATE", "params": { "keyname": "test1", "encrypted": true, "algo": "CIPHER_AES256", "curve": "CURVE_SECP256K1" } }
{
  "id": 0,
  "result": true
}


{ "command": "CMD_SIGN", "params": { "chainid": "de5f4d8974715e20f47c8bb609547c9e66b0b9e31d521199b3d8d6af6da74cb1", "transaction": "871689d060721b5cec5a010080841e00000000000011130065cd1d0000000000000000", "keyname": "test1" } }
{
  "id": 0,
  "result": "200095af52eb0281237904da0f03ba2091d39dc256950b12b21deb990ff620a3a57876b1c3fca281612314f6155736cd0507355bf031d33330ad0cc5e687d7eb02"
}


{ "command": "CMD_LIST" }
{
  "id": 0,
  "result": [
    "test1"
  ]
}
```